import{L as y}from"./Layout-BJFKaUJJ.js";import{T as _}from"./tableau-BdoqOBfb.js";import{P as v}from"./pagination-DBVhxEhs.js";import{c as m}from"./campagneService-DYY7rWAr.js";import{S as l}from"./sweetalert2.all-BmwYcicJ.js";import{e as P,f as D,h as u,o as g,c,a,d as s,v as d,g as f}from"./index-1QRIi6KU.js";import{_ as w}from"./_plugin-vue_export-helper-rQ_DBal5.js";const F={components:{Layout:y,Table:_,Pagination:v},data(){return{newCampagne:{nom:"",description:"",date_debut:"",date_fin:"",lieu:"",image:null},columns:[{label:"ID",field:"id"},{label:"Nom",field:"nom"},{label:"Lieu",field:"lieu"},{label:"Date de Début",field:"date_debut"},{label:"Date de Fin",field:"date_fin"},{label:"Actions",field:"action",type:"action"}],formFields:[{name:"nom",label:"Titre",type:"text",placeholder:"Entrez le titre"},{name:"description",label:"Description",type:"text",placeholder:"Entrez le description"},{name:"lieu",label:"Lieu",type:"text",placeholder:"Entrez le lieu"},{name:"date_debut",label:"Date de debut",type:"date",placeholder:"Entrez la date de debut"},{name:"date_fin",label:"Date de fin",type:"date",placeholder:"Entrez la date de naissance"},{name:"image",label:"Image",type:"file",placeholder:"Entrez l'email de la patiente"}],selectedFile:null,allData:[],paginatedData:[],currentPage:1,totalItems:0,itemsPerPage:10}},mounted(){this.getCampagnes()},methods:{handleFileUpload(t,e){const i=t.target.files[0];e==="image"&&(this.selectedFile=i,this.newCampagne.image=i)},async addCampagne(t){let e="";if(t.nom||(e+="Nom, "),t.description||(e+="Description, "),t.date_debut||(e+="Date de début, "),t.date_fin||(e+="Date de fin, "),t.lieu||(e+="Lieu, "),this.selectedFile||(e+="Image, "),e){l.fire({icon:"error",title:"Erreur",text:`Le(s) champ(s) suivant(s) est(sont) requis : ${e.trim().slice(0,-1)}.`});return}if(!this.selectedFile||this.selectedFile.size===0){l.fire({icon:"error",title:"Erreur",text:"Veuillez sélectionner un fichier valide."});return}try{const i=this.createFormData(t),p=await m.createCampagne(i);this.getCampagnes(),l.fire({title:"Campagne ajoutée avec succès !",icon:"success",showConfirmButton:!1,timer:1500}),this.getCampagnes()}catch(i){console.error("Erreur lors de l'ajout de la campagne :",i),l.fire({title:"Erreur lors de l'ajout de la campagne !",icon:"error",timer:1e3})}},createFormData(t){const e=new FormData;return e.append("nom",t.nom),e.append("description",t.description),e.append("date_debut",t.date_debut),e.append("date_fin",t.date_fin),e.append("lieu",t.lieu),e.append("image",this.selectedFile),e},async getCampagnes(){try{const t=await m.getCampagnes();t&&Array.isArray(t)&&(this.allData=t.map(e=>({id:e.id,nom:e.nom,image:e.image,lieu:e.lieu,description:e.description,date_debut:e.date_debut,date_fin:e.date_fin})),this.totalItems=this.allData.length,this.getCampagnesPaginated())}catch(t){console.error("Erreur lors de la récupération des campagnes :",t)}},handleTableAction({action:t,row:e}){t==="view"?this.$router.push({name:"detailCampagne-badiene-gox",params:{id:e.id}}):t==="edit"?this.editCampagne(e):t==="delete"&&this.deleteCampagne(e.id)},async editCampagne(t){if(!this.selectedFile){console.error("Aucun fichier sélectionné !");return}const e=t.id,i=new FormData;i.append("nom",t.nom),i.append("description",t.description),i.append("date_debut",t.date_debut),i.append("date_fin",t.date_fin),i.append("lieu",t.lieu),i.append("image",this.selectedFile);try{await m.updateCampagne(e,i),this.getCampagnes(),l.fire({title:"Campagne mise à jour avec succès !",icon:"success",timer:1e3})}catch(p){console.error("Erreur lors de la mise à jour de la campagne :",p),l.fire({title:"Erreur lors de la mise à jour de la campagne !",icon:"error",timer:1e3})}},async deleteCampagne(t){l.fire({title:"Êtes-vous sûr de vouloir supprimer cette campagne ?",icon:"warning",showCancelButton:!0,confirmButtonText:"Oui, supprimer",cancelButtonText:"Annuler"}).then(async e=>{if(e.isConfirmed)try{await m.deleteCampagne(t),this.getCampagnes(),l.fire({title:"Campagne supprimée avec succès !",icon:"success",timer:1e3})}catch(i){console.error("Erreur lors de la suppression de la campagne :",i),l.fire({title:"Erreur lors de la suppression de la campagne !",icon:"error",timer:1e3})}})},getCampagnesPaginated(){if(this.allData.length>0){const t=(this.currentPage-1)*this.itemsPerPage,e=t+this.itemsPerPage;this.paginatedData=this.allData.slice(t,e)}},handlePageChange(t){this.currentPage=t,this.getCampagnesPaginated()}}},E={key:0},x={class:"modal fade",id:"ajoutCampagne","data-bs-backdrop":"static","data-bs-keyboard":"false",tabindex:"-1","aria-labelledby":"ajoutCampagneLabel","aria-hidden":"true"},A={class:"modal-dialog"},j={class:"modal-content"},L={class:"modal-body"},I={class:"form-group"},T={class:"form-group"},k={class:"form-group"},z={class:"form-group"},B={class:"form-group"},V={class:"form-group"},U={class:"modal-footer"},q={key:1,class:"tableau"};function N(t,e,i,p,n,r){const b=u("Table"),C=u("Pagination"),h=u("Layout");return g(),P(h,null,{default:D(()=>[n.allData.length===0?(g(),c("div",E,[e[16]||(e[16]=a("button",{type:"button",class:"btn btn-primary","data-bs-toggle":"modal","data-bs-target":"#ajoutCampagne"}," Ajouter une Campagne ",-1)),a("div",x,[a("div",A,[a("div",j,[e[15]||(e[15]=a("div",{class:"modal-header"},[a("h5",{class:"modal-title",id:"ajoutCampagneLabel"}," Ajouter une Campagne "),a("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),a("div",L,[a("div",I,[e[8]||(e[8]=a("label",{for:"nom"},"Nom de la Campagne",-1)),s(a("input",{"onUpdate:modelValue":e[0]||(e[0]=o=>n.newCampagne.nom=o),type:"text",class:"form-control",id:"nom",placeholder:"Nom de la campagne",required:""},null,512),[[d,n.newCampagne.nom]])]),a("div",T,[e[9]||(e[9]=a("label",{for:"nom"},"Lieu de la Campagne",-1)),s(a("input",{"onUpdate:modelValue":e[1]||(e[1]=o=>n.newCampagne.lieu=o),type:"text",class:"form-control",id:"lieu",placeholder:"Lieu de la campagne",required:""},null,512),[[d,n.newCampagne.lieu]])]),a("div",k,[e[10]||(e[10]=a("label",{for:"description"},"Description",-1)),s(a("textarea",{"onUpdate:modelValue":e[2]||(e[2]=o=>n.newCampagne.description=o),class:"form-control",id:"description",placeholder:"Description de la campagne",required:""},null,512),[[d,n.newCampagne.description]])]),a("div",z,[e[11]||(e[11]=a("label",{for:"image"},"Image",-1)),a("input",{type:"file",class:"form-control",id:"image",onChange:e[3]||(e[3]=(...o)=>t.onFileChange&&t.onFileChange(...o))},null,32)]),a("div",B,[e[12]||(e[12]=a("label",{for:"date_debut"},"Date de Début",-1)),s(a("input",{"onUpdate:modelValue":e[4]||(e[4]=o=>n.newCampagne.date_debut=o),type:"date",class:"form-control",id:"date_debut",required:""},null,512),[[d,n.newCampagne.date_debut]])]),a("div",V,[e[13]||(e[13]=a("label",{for:"date_fin"},"Date de Fin",-1)),s(a("input",{"onUpdate:modelValue":e[5]||(e[5]=o=>n.newCampagne.date_fin=o),type:"date",class:"form-control",id:"date_fin",required:""},null,512),[[d,n.newCampagne.date_fin]])])]),a("div",U,[a("button",{class:"btn btn-primary",onClick:e[6]||(e[6]=o=>r.addCampagne(n.newCampagne))}," Ajouter "),e[14]||(e[14]=a("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"}," Fermer ",-1))])])])]),e[17]||(e[17]=a("p",null,"Aucune campagne trouvée.",-1))])):(g(),c("div",q,[f(b,{columns:n.columns,data:n.paginatedData,title:"Liste des Campagnes",onAction:r.handleTableAction,formFields:n.formFields,onAddData:r.addCampagne,onEditData:r.editCampagne,onChange:e[7]||(e[7]=o=>r.handleFileUpload(o,"image"))},null,8,["columns","data","onAction","formFields","onAddData","onEditData"]),f(C,{currentPage:n.currentPage,totalItems:n.totalItems,itemsPerPage:n.itemsPerPage,onPageChanged:r.handlePageChange},null,8,["currentPage","totalItems","itemsPerPage","onPageChanged"])]))]),_:1})}const Q=w(F,[["render",N]]);export{Q as default};
